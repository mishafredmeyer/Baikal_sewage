analysis_day = day(mdy(analysis_date))) %>%
select(-collection_date, -analysis_date, -batch)
# Take a look
head(ppcp)
# Export new version of the data
write.csv(x = ppcp, file = "../clean_disaggregated_data/ppcp.csv",
row.names = FALSE)
nutrients_orig <- read.csv(file = "../original_data/baikal_nearshore_nutrient_data_20151009.csv",
header = TRUE)
# Take nutrients, clean column names, and standardize relational column
nutrients <- nutrients_orig %>%
clean_names(case = "snake") %>%
rename(site = sample)
head(nutrients)
chla_orig <- read.csv(file = "../original_data/chlorophyll_20170117.csv",
header = TRUE)
# Select sites of interest and take average chl a by site
chlorophylla <- chla_orig %>%
select(-Chlorophyll) %>%
filter(Station == "LI-1" |
Station == "LI-2" |
Station == "LI-3" |
Station == "BK-1" |
Station == "BK-2" |
Station == "BK-3" |
Station == "BGO-1" |
Station == "BGO-2" |
Station == "BGO-3" |
Station == "KD-1" |
Station == "KD-2" |
Station == "EM-1" |
Station == "MS-1" |
Station == "SM-1" |
Station == "OS-1" |
Station == "OS-2" |
Station == "OS-3") %>%
clean_names(case = "snake") %>%
# Correct unintended formatting as dates
mutate(replicate = as.character(replicate),
replicate = ifelse(test = grepl(pattern = "Jan", x = replicate),
yes = 1, no = replicate),
replicate = ifelse(test = grepl(pattern = "Feb", x = replicate),
yes = 2, no = replicate),
replicate = ifelse(test = grepl(pattern = "Mar", x = replicate),
yes = 3, no = replicate)) %>%
rename(site = station)
stable_isotopes_orig <- read.csv(file = "../original_data/sia_results_mfm_20170509.csv",
header = TRUE)
View(stable_isotopes_orig)
# Parse identifier data into site and taxonomic data
# In this analysis, "Splash zone" was used as the shorthand
# for periphyton. We relabel "Splash zone" as periphyton as such.
stable_isotopes <- stable_isotopes_orig %>%
separate(col = Identifier, into = c("site", "Genus", "Species"), sep = " ") %>%
mutate(Genus = ifelse(test = Genus == "E.",
yes = "Eulimnogammarus", Genus),
Genus = ifelse(test = Genus == "P.",
yes = "Pallasea", no = Genus),
Genus = ifelse(test = Genus == "Sp.",
yes = "Periphyton", no = Genus),
Species = ifelse(test = Species == "can",
yes = "cancellus", no = Species),
Species = ifelse(test = Species == "ver",
yes = "verrucosus", no = Species),
Species = ifelse(test = Species == "vitetus",
yes = "vittatus", no = Species),
Species = ifelse(test = Species == "veruossus",
yes = "verrucosus", no = Species),
Species = ifelse(test = Species == "cyan",
yes = "cyaneus", no = Species),
Species = ifelse(test = Species == "zone",
yes = NA, no = Species))
head(stable_isotopes)
View(stable_isotopes)
write.csv(x = stable_isotopes, file = "../clean_disaggregated_data/stable_isotopes.csv",
row.names = FALSE)
fatty_acid_orig <- read.csv(file = "../original_data/BaikalFAs_wt_20180322.csv",
header = TRUE)
View(fatty_acid_orig)
# Parse spp column into taxonomic data
fatty_acid <- fatty_acid_orig %>%
clean_names() %>%
select(-gc_id, -sample) %>%
separate(col = spp, into = c("Genus", "Species")) %>%
mutate(Genus = ifelse(test = Genus == "E" & Species == "ver",
yes = "Eulimnogammarus", no = Genus),
Genus = ifelse(test = Genus == "E" & Species == "vitatus",
yes = "Eulimnogammarus", no = Genus),
Genus = ifelse(test = Genus == "E" & Species == "cyan",
yes = "Eulimnogammarus", no = Genus),
Genus = ifelse(test = Genus == "P" & Species == "can",
yes = "Pallasea", no = Genus),
Genus = ifelse(test = Genus == "Spl",
yes = "Periphyton", no = Genus),
Genus = ifelse(test = Genus == "Drapa",
yes = "Draparnaldia", no = Genus),
Species = ifelse(test = Genus == "Eulimnogammarus" & Species == "ver",
yes = "verrucosus", no = Species),
Species = ifelse(test = Genus == "Eulimnogammarus" & Species == "vitatus",
yes = "vittatus", no = Species),
Species = ifelse(test = Genus == "Eulimnogammarus" & Species == "cyan",
yes = "cyaneus", no = Species),
Species = ifelse(test = Genus == "Pallasea" & Species == "can",
yes = "cancellus", no = Species),
Species = ifelse(test = Species == "zone",
yes = NA, no = Species)) %>%
rename(site = location) %>%
select(site:c24_0, comments)
head(fatty_acid)
View(fatty_acid)
write.csv(x = fatty_acid, file = "../clean_disaggregated_data/fatty_acid.csv",
row.names = FALSE)
library(tidyverse)
library(lubridate)
library(stringr)
fatty_acid_orig <- read.csv(file = "../clean_disaggregated_data/fatty_acid.csv",
header = TRUE)
# Remove comments column because our analysis focuses on proportions
fatty_acids <- fatty_acid_orig %>%
select(-comments)
head(fatty_acids)
write.csv(x = fatty_acids, file = "../cleaned_data/fatty_acid.csv",
row.names = FALSE)
fatty_acid <- read.csv(file = "../cleaned_data/fatty_acid.csv",
header = TRUE, stringsAsFactors = FALSE)
fatty_acid
metadata <- read.csv(file = "../cleaned_data/metadata.csv",
header = TRUE, stringsAsFactors = FALSE)
distance <- read.csv(file = "../cleaned_data/distance_weighted_population_metrics.csv",
header = TRUE, stringsAsFactors = FALSE)
nutrients <- read.csv(file = "../cleaned_data/nutrients.csv",
header = TRUE, stringsAsFactors = FALSE)
metadata_dist <- full_join(x = metadata, y = distance)
ppcp <- read.csv(file = "../cleaned_data/ppcp.csv",
header = TRUE, stringsAsFactors = FALSE)
ppcp_meta_dist <- full_join(x = ppcp, y = metadata_dist, by = c("site"))
fatty_acid_ppcp_meta_dist <- inner_join(x = fatty_acid, y = ppcp_meta_dist,
by = c("site")) %>%
unite(taxon, c("Genus", "Species"), remove = FALSE)
# Create a dataframe of the entire fatty acid spectrum
fatty_acid_whole_wide <- fatty_acid %>%
filter(Genus != "Hyalella") %>%
select(site:c24_0) %>%
gather(key = fatty_acid, value = concentration, c12_0:c24_0) %>%
group_by(site, Genus, Species) %>%
mutate(total_fatty_acid = sum(concentration),
prop_fatty_acid = concentration / total_fatty_acid) %>%
select(-concentration, - total_fatty_acid) %>%
spread(key = fatty_acid, value = prop_fatty_acid) %>%
unite(taxon, c("Genus", "Species"), sep = "_", remove = FALSE)
# Identify mean, variance, and coefficient of variation across all
# sites for each taxonomic grouping
mean <- as.vector(sapply(fatty_acid_whole_wide[, 5:63], mean))
var <- as.vector(sapply(fatty_acid_whole_wide[, 5:63], var))
mean_var <- data.frame(cbind(Mean = mean[1:59], Variance = var[1:59]))
mean_var <- dplyr::mutate(mean_var, Var_Mean_Ratio = Variance / Mean)
row.names(mean_var) <- colnames(fatty_acid_whole_wide[, 5:63])
mean_var[order(mean_var$Var_Mean_Ratio, decreasing = TRUE), ]
write.csv(x = mean_var[order(mean_var$Var_Mean_Ratio, decreasing = TRUE), ],
file = "../tables/cv_all_fa.csv", row.names = TRUE)
# Perform NMDS
whole_fatty_acid_metaMDS <- metaMDS(comm = fatty_acid_whole_wide[, 5:63],
distance = "bray", k = 2, try = 100)
whole_fatty_acid_metaMDS
# Extract scores for each site and add additional data for analysis and plotting
data_scores <- as.data.frame(scores(whole_fatty_acid_metaMDS)) %>%
mutate(site = fatty_acid_whole_wide$site,
taxon = fatty_acid_whole_wide$taxon,
taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = gsub(pattern = "Drapa", replacement = "Drapa spp.", x = taxon))
# Extract scores for each site and add additional data for analysis and plotting
data_scores <- as.data.frame(scores(whole_fatty_acid_metaMDS)) %>%
mutate(site = fatty_acid_whole_wide$site,
taxon = fatty_acid_whole_wide$taxon,
taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = gsub(pattern = "Draparnaldia", replacement = "Drapa spp.", x = taxon))
# Pull species scores from NMDS
species_scores <- as.data.frame(scores(x = whole_fatty_acid_metaMDS, display = "species"))
species_scores$species <- rownames(species_scores)
# Create plot
# This figure is associated with figure S1 in the associated manuscript
nmds <- ggplot() +
geom_point(data = data_scores, aes(x = NMDS1, y = NMDS2, fill = taxon),
size = 10, alpha = .6, shape = 21, stroke = 2, color = "grey60") +
scale_fill_viridis_d(option = "plasma") +
geom_text_repel(data = species_scores %>%
filter(species %in% c("c18_3w3", "c18_1w9", "c18_2w6", "c16_0",
"c14_0", "c20_5w3", "c16_1w7")) %>%
mutate(NMDS2 = ifelse(test = species == "c14_0", yes = NMDS2+0.04,
no = NMDS2),
NMDS2 = ifelse(test = species == "c16_1w7", yes = NMDS2-0.02,
no = NMDS2),
species = gsub(pattern = "c", replacement = "",
x = species),
species = gsub(pattern = "_", replacement = ":",
x = species),
species = gsub(pattern = "w", replacement = "\U03C9",
x = species)),
aes(x = NMDS1, y = NMDS2, label = species),
size = 10) +
ggtitle("NMDS with Entire FA Spectrum") +
annotate("label", x = 0.4, y = 0.45,
label = paste("Stress: ", round(whole_fatty_acid_metaMDS$stress, digits = 3)),
size = 10) +
theme_minimal() +
theme(legend.position = "bottom",
title = element_text(size = 20),
axis.text = element_text(size = 16),
axis.title = element_text(size = 18),
legend.text = element_text(size = 12))
nmds
species_scores
# Extract scores for each site and add additional data for analysis and plotting
data_scores <- as.data.frame(scores(whole_fatty_acid_metaMDS)) %>%
mutate(site = fatty_acid_whole_wide$site,
taxon = fatty_acid_whole_wide$taxon,
taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = gsub(pattern = "Draparnaldia", replacement = "Draparnaldia spp.", x = taxon))
# Pull species scores from NMDS
species_scores <- as.data.frame(scores(x = whole_fatty_acid_metaMDS, display = "species"))
species_scores$species <- rownames(species_scores)
# Create plot
# This figure is associated with figure S1 in the associated manuscript
nmds <- ggplot() +
geom_point(data = data_scores, aes(x = NMDS1, y = NMDS2, fill = taxon),
size = 10, alpha = .6, shape = 21, stroke = 2, color = "grey60") +
scale_fill_viridis_d(option = "plasma") +
geom_text_repel(data = species_scores %>%
filter(species %in% c("c18_3w3", "c18_1w9", "c18_2w6", "c16_0",
"c14_0", "c20_5w3", "c16_1w7")) %>%
mutate(NMDS2 = ifelse(test = species == "c14_0", yes = NMDS2+0.04,
no = NMDS2),
NMDS2 = ifelse(test = species == "c16_1w7", yes = NMDS2-0.02,
no = NMDS2),
species = gsub(pattern = "c", replacement = "",
x = species),
species = gsub(pattern = "_", replacement = ":",
x = species),
species = gsub(pattern = "w", replacement = "\U03C9",
x = species)),
aes(x = NMDS1, y = NMDS2, label = species),
size = 10) +
ggtitle("NMDS with Entire FA Spectrum") +
annotate("label", x = 0.4, y = 0.45,
label = paste("Stress: ", round(whole_fatty_acid_metaMDS$stress, digits = 3)),
size = 10) +
theme_minimal() +
theme(legend.position = "bottom",
title = element_text(size = 20),
axis.text = element_text(size = 16),
axis.title = element_text(size = 18),
legend.text = element_text(size = 12))
nmds
ggsave(filename = "all_species_all_FA.png", plot = nmds, device = "png",
path = "../figures/", width = 14, height = 10, units = "in", dpi = 300)
# Create a dataframe of only the essential fatty acids
fatty_acid_essential_wide <- fatty_acid %>%
filter(Genus != "Hyalella") %>%
select(site, Genus, Species, c18_3w3, c18_4w3, c20_5w3, c22_5w3, c22_6w3,
c18_2w6, c18_2w6t, c20_4w6) %>%
gather(key = fatty_acid, value = concentration, c18_3w3:c20_4w6) %>%
group_by(site, Genus, Species) %>%
mutate(total_fatty_acid = sum(concentration),
prop_fatty_acid = concentration / total_fatty_acid) %>%
select(-concentration, - total_fatty_acid) %>%
spread(key = fatty_acid, value = prop_fatty_acid) %>%
unite(col = taxon, c("Genus", "Species"), sep = "_", remove = FALSE)
# Identify mean, variance, and coefficient of variation across all
# sites for each taxonomic grouping
mean <- as.vector(sapply(fatty_acid_essential_wide[, 5:12], mean))
var <- as.vector(sapply(fatty_acid_essential_wide[, 5:12], var))
mean_var <- data.frame(cbind(Mean = mean[1:8], Variance = var[1:8]))
mean_var <- dplyr::mutate(mean_var, Var_Mean_Ratio = Variance / Mean)
row.names(mean_var) <- colnames(fatty_acid_essential_wide[, 5:12])
mean_var[order(mean_var$Var_Mean_Ratio, decreasing = TRUE), ]
write.csv(x = mean_var[order(mean_var$Var_Mean_Ratio, decreasing = TRUE), ],
file = "../tables/cv_efa.csv", row.names = TRUE)
# Perform NMDS
essential_fatty_acid_metaMDS <- metaMDS(comm = fatty_acid_essential_wide[, 5:12],
distance = "bray", k = 2, try = 100)
essential_fatty_acid_metaMDS
# Extract data scores for plotting and analysis of the NMDS
data_scores <- as.data.frame(scores(essential_fatty_acid_metaMDS)) %>%
mutate(site = fatty_acid_essential_wide$site,
taxon = fatty_acid_essential_wide$taxon,
taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = gsub(pattern = "Draparnaldia", replacement = "Draparnaldia spp.", x = taxon))
# Pull species scores from NMDS
species_scores <- as.data.frame(scores(x = essential_fatty_acid_metaMDS, display = "species"))
species_scores$species <- rownames(species_scores)
# Plot NMDS for all species but only Essential Fatty Acids
# This plot is figure S2 in the associated ms.
nmds <- ggplot() +
geom_point(data = data_scores, aes(x = NMDS1, y = NMDS2, fill = taxon),
size = 10, alpha = .75, shape = 21, stroke = 2, color = "grey70") +
scale_fill_viridis_d(option = "plasma") +
geom_text_repel(data = species_scores %>%
filter(species %in% c("c18_3w3", "c18_2w6", "c20_5w3")) %>%
mutate(species = gsub(pattern = "c", replacement = "",
x = species),
species = gsub(pattern = "_", replacement = ":",
x = species),
species = gsub(pattern = "w", replacement = "\U03C9",
x = species)),
aes(x = NMDS1, y = NMDS2, label = species),
size = 10) +
ggtitle("NMDS with Essential FA Spectrum") +
annotate("label", x = -0.5, y = 0.35,
label = paste("Stress: ",
round(essential_fatty_acid_metaMDS$stress, digits = 3)),
size = 10) +
theme_minimal() +
theme(legend.position = "bottom",
title = element_text(size = 20),
axis.text = element_text(size = 16),
axis.title = element_text(size = 18),
legend.text = element_text(size = 12))
nmds
ggsave(filename = "all_species_essential_FA_symbol.png", plot = nmds, device = "png",
path = "../figures/", width = 12, height = 10, units = "in",
dpi = 300)
ggsave(filename = "all_species_essential_FA.png", plot = nmds, device = "png",
path = "../figures/", width = 12, height = 10, units = "in",
dpi = 300)
sample_count <- fatty_acid_ppcp_meta_dist %>%
group_by(Genus, Species) %>%
count()
fatty_acid_type_props_summary_table <- fatty_acid_prop_ppcp_meta_dist %>%
gather(fatty_acid, fa_prop, a_15_0:i_17_0) %>%
mutate(fatty_acid_type = ifelse(fatty_acid %in% safa, "SAFA", "Branched"),
fatty_acid_type = ifelse(fatty_acid %in% mufa, "MUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% scufa, "SCUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% lcufa, "LCUFA", fatty_acid_type)) %>%
select(site, Genus, Species, fatty_acid_type, fa_prop) %>%
group_by(site, Genus, Species, fatty_acid_type) %>%
summarize(sum_fa_prop = sum(fa_prop)) %>%
ungroup() %>%
group_by(Genus, Species, fatty_acid_type) %>%
summarize(mean_fa_prop = mean(sum_fa_prop)) %>%
inner_join(., sample_count) %>%
filter(Genus != "Hyalella") %>%
spread(fatty_acid_type, mean_fa_prop)
# Create proportions of each fatty acid in the dataset
fatty_acid_prop_ppcp_meta_dist <- fatty_acid_ppcp_meta_dist %>%
gather(key = fatty_acid, value = concentration, c12_0:c24_0) %>%
group_by(site, Genus, Species) %>%
mutate(total_fatty_acid = sum(concentration),
prop_fatty_acid = concentration / total_fatty_acid) %>%
select(-concentration, -total_fatty_acid) %>%
spread(key = fatty_acid, value = prop_fatty_acid)
safa <- c("c12_0", "c14_0", "a_15_0",  "c15_0", "i_15_0",
"c16_0", "a_17_0", "c17_0", "i_17_0", "c18_0", "c20_0", "c22_0", "c24_0")
mufa <- c("c14_1n5", "c15_1w7", "c17_1n7",
"c16_1w5", "c16_1w6", "c16_1w7", "c16_1w8", "c16_1w9",
"c18_1w7", "c18_1w9", "c20_1w7", "c20_1w9", "c22_1w7", "c22_1w9")
scufa <- c("c16_2w4", "c16_2w6", "c16_2w7", "c16_3w3", "c16_3w4", "c16_3w6", "c16_4w1", "c16_4w3",
"c18_2w6", "c18_2w6t", "c18_3w3", "c18_3w6", "c18_4w3", "c18_4w4", "c18_5w3")
lcufa <- c("c20_2_5_11", "c20_2_5_13", "c20_2w6", "c20_3w3", "c20_3w6", "c20_4w3", "c20_4w6", "c20_5w3",
"c22_2w6", "c22_3w3", "c22_4w3", "c22_4w6", "c22_5w3", "c22_5w6", "c22_6w3")
complete_fatty_acid_repo <- data.frame(rbind(c("SAFA", paste(safa, collapse = ", ")),
c("MUFA", paste(mufa, collapse = ", ")),
c("SCUFA", paste(scufa, collapse = ", ")),
c("LCUFA", paste(lcufa, collapse = ", ")))) %>%
rename("fatty_acid_group" = "X1",
"fatty_acid_included" = "X2")
write.csv(x = complete_fatty_acid_repo,
file = "../tables/complete_fatty_acid_repo.csv",
row.names = FALSE)
sample_count <- fatty_acid_ppcp_meta_dist %>%
group_by(Genus, Species) %>%
count()
fatty_acid_type_props_summary_table <- fatty_acid_prop_ppcp_meta_dist %>%
gather(fatty_acid, fa_prop, a_15_0:i_17_0) %>%
mutate(fatty_acid_type = ifelse(fatty_acid %in% safa, "SAFA", "Branched"),
fatty_acid_type = ifelse(fatty_acid %in% mufa, "MUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% scufa, "SCUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% lcufa, "LCUFA", fatty_acid_type)) %>%
select(site, Genus, Species, fatty_acid_type, fa_prop) %>%
group_by(site, Genus, Species, fatty_acid_type) %>%
summarize(sum_fa_prop = sum(fa_prop)) %>%
ungroup() %>%
group_by(Genus, Species, fatty_acid_type) %>%
summarize(mean_fa_prop = mean(sum_fa_prop)) %>%
inner_join(., sample_count) %>%
filter(Genus != "Hyalella") %>%
spread(fatty_acid_type, mean_fa_prop)
fatty_acid_type_props_summary_table
write.csv(x = fatty_acid_type_props_summary_table,
file = "../tables/fatty_acid_type_props_summary_table.csv",
row.names = FALSE)
fatty_acid_type_props_plot <- fatty_acid_prop_ppcp_meta_dist %>%
gather(fatty_acid, fa_prop, a_15_0:i_17_0) %>%
mutate(fatty_acid_type = ifelse(fatty_acid %in% safa, "SAFA", "Branched"),
fatty_acid_type = ifelse(fatty_acid %in% mufa, "MUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% scufa, "SCPUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% lcufa, "LCPUFA", fatty_acid_type)) %>%
mutate(taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = ifelse(test = grepl(pattern = "Drapa", x = taxon),
yes = "Drapa spp.", no = taxon)) %>%
select(site, ppcp_sum, distance_weighted_population, taxon,
Genus, Species, fatty_acid_type, fa_prop) %>%
group_by(site, ppcp_sum, distance_weighted_population, taxon,
Genus, Species, fatty_acid_type, ) %>%
summarize(sum_fa_prop = sum(fa_prop)) %>%
ungroup() %>%
filter(Genus != "Hyalella") %>%
ggplot(aes(x = log10(ppcp_sum), y = sum_fa_prop, color = taxon)) +
geom_point(size = 4) +
geom_smooth(method = "lm", se = FALSE) +
scale_color_viridis_d(option = "viridis") +
facet_grid(~fatty_acid_type) +
ylab("Total proportion") +
xlab("log10([Total PPCP])") +
theme_bw() +
theme(legend.position = "bottom",
title = element_text(size = 20),
axis.text = element_text(size = 16),
axis.title = element_text(size = 20),
legend.text = element_text(size = 20),
strip.text = element_text(size = 16))
fatty_acid_type_props_plot <- fatty_acid_prop_ppcp_meta_dist %>%
gather(fatty_acid, fa_prop, a_15_0:i_17_0) %>%
mutate(fatty_acid_type = ifelse(fatty_acid %in% safa, "SAFA", "Branched"),
fatty_acid_type = ifelse(fatty_acid %in% mufa, "MUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% scufa, "SCPUFA", fatty_acid_type),
fatty_acid_type = ifelse(fatty_acid %in% lcufa, "LCPUFA", fatty_acid_type)) %>%
mutate(taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = ifelse(test = grepl(pattern = "Draparnaldia", x = taxon),
yes = "Draparnaldia spp.", no = taxon)) %>%
select(site, ppcp_sum, distance_weighted_population, taxon,
Genus, Species, fatty_acid_type, fa_prop) %>%
group_by(site, ppcp_sum, distance_weighted_population, taxon,
Genus, Species, fatty_acid_type, ) %>%
summarize(sum_fa_prop = sum(fa_prop)) %>%
ungroup() %>%
filter(Genus != "Hyalella") %>%
ggplot(aes(x = log10(ppcp_sum), y = sum_fa_prop, color = taxon)) +
geom_point(size = 4) +
geom_smooth(method = "lm", se = FALSE) +
scale_color_viridis_d(option = "viridis") +
facet_grid(~fatty_acid_type) +
ylab("Total proportion") +
xlab("log10([Total PPCP])") +
theme_bw() +
theme(legend.position = "bottom",
title = element_text(size = 20),
axis.text = element_text(size = 16),
axis.title = element_text(size = 20),
legend.text = element_text(size = 20),
strip.text = element_text(size = 16))
fatty_acid_type_props_plot
ggsave(filename = "fatty_acid_type_props_plot.png", plot = fatty_acid_type_props_plot, device = "png",
path = "../figures/", height = 8, width = 15, units = "in")
periphyton_fatty_acids <- fatty_acid_prop_ppcp_meta_dist %>%
filter(Genus %in% c("Periphyton", "Draparnaldia")) %>%
select(site:distance_weighted_population, c18_3w3, c16_0, c18_1w9, c18_2w6,
c16_1w7, c20_5w3, c14_0)
peri_nmds <- metaMDS(comm = periphyton_fatty_acids[ , 19:25], distance = "bray", try = 100, k = 1)
# Extract scores for each site and add additional data for analysis and plotting
data_scores <- as.data.frame(scores(peri_nmds)) %>%
mutate(site = periphyton_fatty_acids$site,
taxon = periphyton_fatty_acids$taxon,
taxon = gsub(pattern = "_", replacement = " ", x = taxon),
taxon = gsub(pattern = "NA", replacement = "", x = taxon),
taxon = gsub(pattern = "Draparnaldia", replacement = "Draparnaldia spp.", x = taxon),
ppcp_sum = periphyton_fatty_acids$ppcp_sum)
species_scores <- as.data.frame(scores(peri_nmds, display = "species"))
species_scores$species <- rownames(species_scores)
# Create plot
# This figure is associated with figure S1 in the associated manuscript
nmds <- ggplot() +
geom_point(data = data_scores, aes(x = NMDS1, y = 0.5,
size = ppcp_sum, fill = taxon),
alpha = .5, shape = 21, stroke = 5, color = "grey70") +
scale_fill_manual(values = viridis(20)[c(4, 10)]) +
geom_text_repel(data = species_scores %>%
mutate(species = gsub(pattern = "c", replacement = "",
x = species),
species = gsub(pattern = "_", replacement = ":",
x = species),
species = gsub(pattern = "w", replacement = "\U03C9",
x = species)),
aes(x = NMDS1, y = 1, label = species),
size = 10, segment.size = NA) +
scale_size_continuous(name = "[Total PPCP]", range = c(10, 30)) +
guides(shape = guide_legend(override.aes = list(size=10))) +
ggtitle("NMDS with Filamentous:Diatom Fatty Acids") +
ylab("") +
ylim(c(0,1.25)) +
annotate("label", x = 0, y = 0.25,
label = paste("Stress: ", round(peri_nmds$stress, digits = 3)),
size = 10) +
theme_minimal() +
guides(fill = guide_legend(override.aes = list(size = 15))) +
theme(legend.position = "right",
title = element_text(size = 20),
axis.text = element_text(size = 20),
axis.title = element_text(size = 20),
legend.text = element_text(size = 20),
axis.text.y = element_blank(),
panel.grid.major.y = element_blank(),
panel.grid.minor.y = element_blank(),
legend.key.height = unit(0.75, "in"))
nmds
ggsave(filename = "filamentous_diatom_nmds_peri_drapa.png", plot = nmds, device = "png",
path = "../figures/", width = 16, height = 8, units = "in")
